<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Aphrodite's Nemo's Transit Expansion</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="Aphrodite's Nemo's Transit Expansion, created by Zbx1425, now developed by Aphrodite , includes some experimental extension functionalities to the MTR Mod. As a contributor to MTR's development, the author hopes to initially release, exhibit and experiment with these new features with this medium, and later merge its stable aspects into the MTR mod itself." />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify/themes/vue.css">
    <link rel="shortcut icon" href="/mtr-ante/img/favicon.ico" type="image/x-icon" />
    <style>
      :root {
        --content-max-width: 65em;
      }
      #deeplx_translate_element {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        margin-top: 10px;
      }
      #languageSelector, #translateButton {
        padding: 5px;
        font-size: 14px;
      }
      #translateButton {
        cursor: pointer;
      }
      .loading {
        cursor: not-allowed;
        opacity: 0.7;
      }
    </style>
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?a7b4bb294e58306810e936ff1e9ba1c5";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  </head>
  <body>
    <div id="deeplx_translate_element">
      <select id="languageSelector">
        <option value="EN">English</option>
        <option value="ZH">中文</option>
        <option value="JA">日本語</option>
        <!-- 添加更多语言选项 -->
      </select>
      <button id="translateButton" onclick="translatePage()">翻译</button>
    </div>

    <script>
      // 翻译文本函数
      async function translateText(text, targetLang) {
        try {
          const response = await fetch('https://api.deeplx.org/translate', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({
              text: text,
              target_lang: targetLang,
            }),
            timeout: 5000, // 设置超时时间为 5 秒
          });

          if (!response.ok) {
            throw new Error('Network response was not ok');
          }

          const data = await response.json();
          return data.translated_text || text; // 如果翻译失败，返回原文
        } catch (error) {
          console.error('翻译出错:', error);
          return text; // 如果翻译失败，返回原文
        }
      }

      // 翻译页面函数
      async function translatePage() {
        const translateButton = document.getElementById('translateButton');
        const targetLang = document.getElementById('languageSelector').value;

        // 设置按钮为加载状态
        translateButton.classList.add('loading');
        translateButton.textContent = '翻译中...';
        translateButton.disabled = true;

        const elements = document.querySelectorAll('body *:not(script):not(style)');
        const promises = [];

        // 遍历所有元素并翻译文本
        elements.forEach(element => {
          Array.from(element.childNodes).forEach(childNode => {
            if (childNode.nodeType === Node.TEXT_NODE && childNode.nodeValue.trim()) {
              const text = childNode.nodeValue.trim();
              promises.push(
                translateText(text, targetLang).then(translatedText => {
                  childNode.nodeValue = translatedText;
                })
              );
            }
          });
        });

        // 等待所有翻译完成
        try {
          await Promise.all(promises);
          alert('翻译完成！');
        } catch (error) {
          console.error('翻译过程中出错:', error);
          alert('翻译出错，请重试！');
        } finally {
          // 恢复按钮状态
          translateButton.classList.remove('loading');
          translateButton.textContent = '翻译';
          translateButton.disabled = false;
        }
      }

      // 根据浏览器语言设置默认翻译语言
      function setDefaultLanguage() {
        const userLang = navigator.language || navigator.userLanguage;
        const languageSelector = document.getElementById('languageSelector');

        if (userLang.startsWith('zh')) {
          languageSelector.value = 'ZH';
        } else if (userLang.startsWith('ja')) {
          languageSelector.value = 'JA';
        } else {
          languageSelector.value = 'EN';
        }
      }

      // 页面加载时设置默认语言
      window.onload = setDefaultLanguage;
    </script>

    <div id="app"></div>
    <script>
      window.$docsify = {
        name: "MTR-ANTE",
        repo: "aphrodite281/mtr-ante",
        loadSidebar: true,
        autoHeader: true,
        subMaxLevel: 3,
        mergeNavbar: true,
        auto2top: true,
        themeColor: '#ff96fd',
        copyCode: {
          buttonText: "复制",
          errorText: "错误",
          successText: "复制成功",
        },
      };
    </script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/emoji.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify-copy-code/dist/docsify-copy-code.min.js"></script>
  </body>
</html>